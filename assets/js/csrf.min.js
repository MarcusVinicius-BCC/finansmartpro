document.addEventListener('DOMContentLoaded',function(){const forms=document.querySelectorAll('form[method="post"],form[method="POST"]');forms.forEach(form=>{const hasCSRF=form.querySelector('input[name="csrf_token"]');if(!hasCSRF){const csrfInput=document.createElement('input');csrfInput.type='hidden';csrfInput.name='csrf_token';csrfInput.value=getCSRFToken();form.insertBefore(csrfInput,form.firstChild);}});});function getCSRFToken(){const metaTag=document.querySelector('meta[name="csrf-token"]');if(metaTag){return metaTag.getAttribute('content');}const existingToken=document.querySelector('input[name="csrf_token"]');if(existingToken){return existingToken.value;}return generateCSRFTokenSync();}function generateCSRFTokenSync(){let token='';const xhr=new XMLHttpRequest();xhr.open('GET','api/get_csrf_token.php',false);xhr.send();if(xhr.status===200){try{const response=JSON.parse(xhr.responseText);token=response.token||'';}catch(e){console.error('Erro ao obter CSRF token:',e);}}return token;}function refreshAllCSRFTokens(){const newToken=generateCSRFTokenSync();if(newToken){const metaTag=document.querySelector('meta[name="csrf-token"]');if(metaTag){metaTag.setAttribute('content',newToken);}const csrfInputs=document.querySelectorAll('input[name="csrf_token"]');csrfInputs.forEach(input=>{input.value=newToken;});}}setInterval(refreshAllCSRFTokens,30*60*1000);